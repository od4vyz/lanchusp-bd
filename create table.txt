-- 1. CLIENTE
CREATE TABLE Cliente (
    CPF CHAR(11) NOT NULL,
    Nome VARCHAR(100) NOT NULL,
    ID SERIAL NOT NULL UNIQUE, 
    CONSTRAINT PK_Cliente PRIMARY KEY (CPF)
);

-- 2. FUNCIONARIO
CREATE TABLE Funcionario (
    CPF CHAR(11) NOT NULL,
    Nome VARCHAR(100) NOT NULL,
    CONSTRAINT PK_Funcionario PRIMARY KEY (CPF)
);

-- 3. LANCHONETE
CREATE TABLE Lanchonete (
    Campus VARCHAR(100) NOT NULL,
    Nome VARCHAR(100) NOT NULL,
    CONSTRAINT PK_Lanchonete PRIMARY KEY (Campus)
);

-- 4. ITEM (Superclasse para Ingredientes e Produtos)
CREATE TABLE Item (
    Nome VARCHAR(100) NOT NULL,
    Categoria VARCHAR(50),
    CONSTRAINT PK_Item PRIMARY KEY (Nome)
);


-- 5. QUADRO_FUNCIONARIOS
CREATE TABLE Quadro_Funcionarios (
    Campus VARCHAR(100) NOT NULL,
    CPF CHAR(11) NOT NULL,
    Cargo VARCHAR(50),
    Salario DECIMAL(10, 2),
    dataAdmissao DATE NOT NULL,
    cargaHoraria INT,
    horarioEntrada TIME,
    
    CONSTRAINT PK_Quadro_Funcionarios PRIMARY KEY (Campus, CPF),
    
    CONSTRAINT FK_Quadro_Lanchonete FOREIGN KEY (Campus) 
        REFERENCES Lanchonete(Campus)
        ON UPDATE CASCADE
        ON DELETE RESTRICT,
        
    CONSTRAINT FK_Quadro_Funcionario FOREIGN KEY (CPF) 
        REFERENCES Funcionario(CPF)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

-- 6. CATALOGO
CREATE TABLE Catalogo (
    Campus VARCHAR(100) NOT NULL,
    NomeItem VARCHAR(100) NOT NULL,
    Preco DECIMAL(10, 2) NOT NULL,
    qtdDisponivel INT NOT NULL DEFAULT 0,
    
    CONSTRAINT PK_Catalogo PRIMARY KEY (Campus, NomeItem),
    
    CONSTRAINT FK_Catalogo_Lanchonete FOREIGN KEY (Campus) 
        REFERENCES Lanchonete(Campus)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
        
    CONSTRAINT FK_Catalogo_Item FOREIGN KEY (NomeItem) 
        REFERENCES Item(Nome)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);


-- 7. COMPRA
CREATE TABLE Compra (
    Campus VARCHAR(100) NOT NULL,
    Fornecedor VARCHAR(100) NOT NULL,
    dataHora TIMESTAMP NOT NULL,
    Valor DECIMAL(10, 2),
    
    CONSTRAINT PK_Compra PRIMARY KEY (Campus, Fornecedor, dataHora),
    
    CONSTRAINT FK_Compra_Lanchonete FOREIGN KEY (Campus) 
        REFERENCES Lanchonete(Campus)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);

-- 8. PEDIDO
CREATE TABLE Pedido (
    Campus VARCHAR(100) NOT NULL,
    CPF CHAR(11) NOT NULL,
    dataHora TIMESTAMP NOT NULL,
    Valor DECIMAL(10, 2),
    meioPagamento VARCHAR(50),
    
    CONSTRAINT PK_Pedido PRIMARY KEY (Campus, CPF, dataHora),
    
    CONSTRAINT FK_Pedido_Lanchonete FOREIGN KEY (Campus) 
        REFERENCES Lanchonete(Campus)
        ON UPDATE CASCADE
        ON DELETE RESTRICT,
        
    CONSTRAINT FK_Pedido_Cliente FOREIGN KEY (CPF) 
        REFERENCES Cliente(CPF)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);


-- 9. COMPRA_ITEM
CREATE TABLE Compra_Item (
    Campus VARCHAR(100) NOT NULL,
    Fornecedor VARCHAR(100) NOT NULL,
    dataHora TIMESTAMP NOT NULL,
    NomeItem VARCHAR(100) NOT NULL,
    ValorUnit DECIMAL(10, 2) NOT NULL,
    Quantidade INT NOT NULL,
    
    CONSTRAINT PK_Compra_Item PRIMARY KEY (Campus, Fornecedor, dataHora, NomeItem),
    
    CONSTRAINT FK_CompraItem_Compra FOREIGN KEY (Campus, Fornecedor, dataHora) 
        REFERENCES Compra(Campus, Fornecedor, dataHora)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
        
    CONSTRAINT FK_CompraItem_Item FOREIGN KEY (NomeItem) 
        REFERENCES Item(Nome)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);

-- 10. PEDIDO_ITEM
CREATE TABLE Pedido_Item (
    Campus VARCHAR(100) NOT NULL,
    CPF CHAR(11) NOT NULL,
    dataHora TIMESTAMP NOT NULL,
    NomeItem VARCHAR(100) NOT NULL,
    Quantidade INT NOT NULL,
    
    CONSTRAINT PK_Pedido_Item PRIMARY KEY (Campus, CPF, dataHora, NomeItem),
    
    CONSTRAINT FK_PedidoItem_Pedido FOREIGN KEY (Campus, CPF, dataHora) 
        REFERENCES Pedido(Campus, CPF, dataHora)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
        
    CONSTRAINT FK_PedidoItem_Item FOREIGN KEY (NomeItem) 
        REFERENCES Item(Nome)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);


-- 11. ARTESANAL (Subclasse de Item - Produto Final)
CREATE TABLE Artesanal (
    Nome VARCHAR(100) NOT NULL,
    tempoPreparo INT, -- Minutos
    
    CONSTRAINT PK_Artesanal PRIMARY KEY (Nome),
    
    CONSTRAINT FK_Artesanal_Item FOREIGN KEY (Nome) 
        REFERENCES Item(Nome)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

-- 12. UTILIZA (Relacionamento Artesanal -> Ingredientes)
CREATE TABLE Utiliza (
    NomeArtesanal VARCHAR(100) NOT NULL,
    NomeIngrediente VARCHAR(100) NOT NULL,
    Quantidade INT NOT NULL,
    
    CONSTRAINT PK_Utiliza PRIMARY KEY (NomeArtesanal, NomeIngrediente),
    
    -- Chave estrangeira para o produto final
    CONSTRAINT FK_Utiliza_Artesanal FOREIGN KEY (NomeArtesanal) 
        REFERENCES Artesanal(Nome)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
        
    -- Chave estrangeira para o ingrediente 
    CONSTRAINT FK_Utiliza_Ingrediente FOREIGN KEY (NomeIngrediente) 
        REFERENCES Item(Nome)
        ON UPDATE CASCADE
        ON DELETE RESTRICT
);